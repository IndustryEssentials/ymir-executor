# æµ‹è¯•Ymirç›®æ ‡æ£€æµ‹é•œåƒ

## é€šè¿‡YMIRå¹³å°è¿›è¡Œæµ‹è¯•

ç”¨æˆ·å¯ä»¥ç›´æ¥é€šè¿‡Ymirå¹³å°å‘èµ·ç›®æ ‡æ£€æµ‹çš„è®­ç»ƒï¼Œæ¨ç†åŠæŒ–æ˜ä»»åŠ¡ï¼Œå¯¹é•œåƒè¿›è¡Œæµ‹è¯•ã€‚ã€

!!! æ³¨æ„
    YMIRå¹³å°å‘èµ·çš„ä»»åŠ¡åœ¨é¡ºåˆ©ç»“æŸæ—¶ï¼Œä¼šæ¸…ç†ç›¸åº”çš„ç›®å½•ï¼Œå› æ­¤åœ¨æµ‹è¯•æ—¶ï¼Œè¯·ç¡®ä¿ç›¸åº”ç›®å½•å­˜åœ¨ã€‚

### å¯¼å…¥å¾…æµ‹é•œåƒ

- å‡è®¾ç”¨æˆ·å·²ç»åˆ¶ä½œå¥½é•œåƒ **demo/det:tmi**, å®ƒæ”¯æŒè®­ç»ƒã€æ¨ç†åŠæŒ–æ˜

- å‡è®¾ç”¨æˆ·å…·æœ‰ç®¡ç†å‘˜æƒé™ï¼ŒæŒ‰ç…§[æ–°å¢é•œåƒ](https://github.com/IndustryEssentials/ymir/wiki/%E6%93%8D%E4%BD%9C%E8%AF%B4%E6%98%8E#%E6%96%B0%E5%A2%9E%E9%95%9C%E5%83%8F) å°†**demo/det:tmi** æ·»åŠ åˆ° **æˆ‘çš„é•œåƒ** ä¸­ã€‚

### å¯¼å…¥å¾…æµ‹æ•°æ®é›†

- ä¸‹è½½ç¤ºä¾‹ç›®æ ‡æ£€æµ‹æ•°æ®é›† [ymir2.0.0_dog_train.zip](https://github.com/modelai/ymir-executor-fork/releases/download/dataset-ymir2.0.0/ymir2.0.0_dog_train.zip)  [ymir2.0.0_dog_val.zip](https://github.com/modelai/ymir-executor-fork/releases/download/dataset-ymir2.0.0/ymir2.0.0_dog_val.zip)

- å»ºç«‹åŒ…å«å¯¹åº”æ ‡ç­¾çš„é¡¹ç›®ï¼Œ `è®­ç»ƒç±»åˆ«` ä¸­æ·»åŠ å¯¹åº”æ ‡ç­¾ `dog`

- æŒ‰ç…§[æ·»åŠ æ•°æ®é›†](https://github.com/IndustryEssentials/ymir/wiki/%E6%93%8D%E4%BD%9C%E8%AF%B4%E6%98%8E#%E6%B7%BB%E5%8A%A0%E6%95%B0%E6%8D%AE%E9%9B%86)å¯¼å…¥ç¤ºä¾‹ç›®æ ‡æ£€æµ‹æ•°æ®é›†

### å‘èµ·å¾…æµ‹ä»»åŠ¡

å‘èµ·å¾…æµ‹çš„è®­ç»ƒã€æ¨ç†æˆ–æŒ–æ˜ä»»åŠ¡åï¼Œç­‰å¾…å…¶ç»“æŸæˆ–å‡ºé”™ã€‚

### è·å–ä»»åŠ¡id

ç™»å½•æœåŠ¡å™¨åå°ï¼Œè¿›å…¥YMIRéƒ¨ç½²çš„ç›®å½• `ymir-workplace`

- å¯¹äºè®­ç»ƒä»»åŠ¡ï¼š`cd sandbox/work_dir/TaskTypeTraining`

- å¯¹äºæŒ–æ˜æˆ–æ¨ç†ä»»åŠ¡ï¼š `cd sandbox/work_dir/TaskTypeMining`

- å¯¹äºå•å¼ å›¾ç‰‡æµ‹è¯•ä»»åŠ¡ï¼š `cd sandbox/work_dir/TaskTypeInfer`

- åˆ—ä¸¾å½“å‰æ‰€æœ‰çš„ä»»åŠ¡ï¼ŒæŒ‰ä»»åŠ¡æ—¶é—´æ‰¾åˆ°å¯¹åº”ä»»åŠ¡id, æ­¤å¤„å‡è®¾ä¸ºæœ€æ–°çš„ **t00000020000023a473e1673591617**

!!! æ³¨æ„
    å¯¹äºè®­ç»ƒä»»åŠ¡ï¼Œ å¯é€šè¿‡tensorboardé“¾æ¥è·å¾—å¯¹åº”ä»»åŠ¡idã€‚

```
> ls -lt .

drwxr-xr-x 4 root root 45 Jan 13 14:33 t00000020000023a473e1673591617
drwxr-xr-x 4 root root 45 Jan 13 14:19 t00000020000025d55ff1673590756
drwxr-xr-x 4 root root 45 Jan 13 14:13 t00000020000028b0cce1673590425
drwxr-xr-x 4 root root 45 Jan 10 14:09 t00000020000018429301673330944
drwxr-xr-x 4 root root 45 Jan  9 18:21 t000000200000210e0811673259669
drwxr-xr-x 4 root root 45 Jan  9 18:07 t00000020000029e02f61673258829
```

### é€šè¿‡ docker è¿›è¡Œäº¤äº’å¼è°ƒè¯•

- è¿›è¡Œä»»åŠ¡idå¯¹åº”çš„å·¥ä½œç›®å½• `cd t00000020000023a473e1673591617/sub_task/t00000020000023a473e1673591617`

- åˆ—ä¸¾å½“å‰ç›®å½•å¯ä»¥çœ‹åˆ° `in` å’Œ `out` ç›®å½•

- è¿›è¡Œäº¤äº’å¼è°ƒè¯•

    - å‡è®¾ `ymir-workplace` å­˜æ”¾åœ¨ **/data/ymir/ymir-workplace**, éœ€è¦å°† `ymir-workplace` ç›®å½•ä¹ŸæŒ‚è½½åˆ°é•œåƒä¸­ç›¸åŒä½ç½®ï¼Œä»¥ç¡®ä¿æ‰€æœ‰è½¯é“¾æ¥å‡æœ‰æ•ˆã€‚

    - å‡è®¾å¯åŠ¨ç¨‹åºä¸º **/usr/bin/start.sh**

```
# --ipc host è¡¨ç¤ºå®¹å™¨å…±äº«ä¸»æœºçš„æ‰€æœ‰å†…å­˜
docker run -it --rm --gpus all --ipc host -v $PWD/in:/in -v $PWD/out:/out -v /data:/data demo/det:tmi bash

# --shm-size 128g è¡¨ç¤ºå®¹å™¨æœ€å¤šå…±äº«ä¸»æœº128Gå†…å­˜
# docker run -it --rm --gpus all --shm-size 128g -v $PWD/in:/in -v $PWD/out:/out -v /data:/data demo/det:tmi bash

bash /usr/bin/start.sh
```

- å‡è®¾ç”¨æˆ·å¼€å‘é•œåƒçš„ä»£ç å­˜æ”¾åœ¨ **/home/modelai/code**ï¼Œ ä¸ºæ–¹ä¾¿æµ‹è¯•ï¼Œ å¯ä»¥å°† **/home/modelai/code** ä¹ŸæŒ‚è½½åˆ°é•œåƒä¸­è¿›è¡Œæµ‹è¯•ã€‚

    - å‡è®¾å®é™…å¯åŠ¨ç¨‹åºä¸º **start.py**

```
docker run -it --rm --gpus all --ipc host -v $PWD/in:/in -v $PWD/out:/out -v /data:/data -v /home/modelai/code:/home/modelai/code demo/det:tmi bash

cd /home/modelai/code
python start.py
```

### æµ‹è¯•é€šè¿‡å

- é€šè¿‡ `docker build` é‡æ–°æ„å»ºé•œåƒï¼Œ å¦‚æœä¿®æ”¹äº†è¶…å‚æ•°ï¼Œéœ€è¦åœ¨Ymirå¹³å°åˆ é™¤æ—§é•œåƒå¹¶é‡æ–°æ·»åŠ ï¼Œä½¿æ›´æ–°çš„è¶…å‚æ•°ç”Ÿæ•ˆã€‚å¦‚æœä»…ä»…ä¿®æ”¹äº†ä»£ç ï¼Œä¸éœ€è¦é‡æ–°æ·»åŠ å³å¯ä½¿ç”¨æœ¬åœ°çš„æœ€æ–°é•œåƒã€‚


## ğŸ’« YMIRåå°é”™è¯¯æŸ¥çœ‹

- å¦‚é•œåƒæ­£ç¡®è¿è¡Œï¼Œä½†è¾“å‡ºæ ¼å¼ä¸ç¬¦åˆYMIRåå°è¦æ±‚ï¼Œæˆ–å…¶ä»–é”™è¯¯ï¼Œå¯åœ¨ `ymir-workplace/ymir-data/logs` ä¸‹æŸ¥çœ‹

```
tail -f -n 200 ymir_controller.log
```

## ğŸ’« é€šè¿‡ ymir-executor-verifier è¿›è¡Œæµ‹è¯•

[ymir-executor-verifier](https://github.com/modelai/ymir-executor-verifier) é¢å‘ä¼ä¸šç”¨æˆ·ï¼Œç›®çš„æ˜¯å¯¹å¤§é‡é•œåƒè¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œä»¥ä¿éšœé•œåƒçš„è´¨é‡ã€‚
